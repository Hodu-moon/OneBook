<!DOCTYPE html>
<html lang="zxx">
<head>
	<!-- Meta Tag -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name='copyright' content=''>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Title Tag  -->
	<title>Eshop - eCommerce HTML5 Template.</title>
	<!-- Favicon -->
	<link rel="icon" type="image/png" href="/images/favicon.png">
	<!-- Web Font -->
	<link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">

	<!-- StyleSheet -->
	<!-- Bootstrap -->
	<link rel="stylesheet" href="/css/bootstrap.css">
	<!-- Magnific Popup -->
	<link rel="stylesheet" href="/css/magnific-popup.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/css/font-awesome.css">
	<!-- Fancybox -->
	<link rel="stylesheet" href="/css/jquery.fancybox.min.css">
	<!-- Themify Icons -->
	<link rel="stylesheet" href="/css/themify-icons.css">
	<!-- Nice Select CSS -->
	<link rel="stylesheet" href="/css/niceselect.css">
	<!-- Animate CSS -->
	<link rel="stylesheet" href="/css/animate.css">
	<!-- Flex Slider CSS -->
	<link rel="stylesheet" href="/css/flex-slider.min.css">
	<!-- Owl Carousel -->
	<link rel="stylesheet" href="/css/owl-carousel.css">
	<!-- Slicknav -->
	<link rel="stylesheet" href="/css/slicknav.min.css">

	<!-- Eshop StyleSheet -->
	<link rel="stylesheet" href="/css/reset.css">
	<link rel="stylesheet" href="/style.css">
	<link rel="stylesheet" href="/css/responsive.css">

	<!-- Color CSS -->
	<link rel="stylesheet" href="/css/color/color1.css">
	<link rel="stylesheet" href="#" id="colors">

	<style>
		/* 기존 스타일 유지 */

		/* 리뷰 섹션 스타일 */
		.ratting-main {
			margin-bottom: 40px;
			width: 100%;
		}

		.single-rating {
			display: flex;
			flex-direction: column;
			margin-bottom: 30px;
			padding-bottom: 20px;
			border-bottom: 1px solid #eee;
		}

		.rating-des h6 {
			font-size: 18px;
			color: #333;
			margin-bottom: 5px;
		}

		.rating-des .ratings {
			display: flex;
			align-items: center;
			margin-bottom: 10px;
		}

		.rating-des .rating li {
			color: #F7941D;
			margin-right: 5px;
		}

		.rating-des p {
			font-size: 14px;
			color: #555;
			word-wrap: break-word;
			display:inline;
		}

		.image-preview {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
			margin-top: 10px;
		}

		.image-preview a {
			display: inline-block;
			border: 1px solid #ddd;
			border-radius: 3px;
			overflow: hidden;
		}

		.image-preview img {
			max-width: 100px;
			height: auto;
			cursor: pointer;
			transition: transform 0.3s ease;
		}

		.image-preview img:hover {
			transform: scale(1.1);
		}

		.edit-btn {
			background: #eee;
			border: none;
			color: #333;
			padding: 3px 5px;
			border-radius: 3px;
			cursor: pointer;
			margin-top: 10px;
			font-size: 12px;
		}
		.edit-btn:hover {
			background: #ccc;
		}

		.toggle-more-btn {
			margin-left:5px;
			font-size:12px;
			background:#eee;
			border:none;
			padding:3px 5px;
			border-radius:3px;
			cursor:pointer;
		}

		@media (max-width: 768px) {
			.single-rating {
				flex-direction: column;
				align-items: flex-start;
				text-align: left;
			}
		}

		#pagination span {
			display:inline-block;
			padding:5px 10px;
			margin:0 5px;
			background:#eee;
			color:#333;
			border-radius:3px;
			cursor:pointer;
		}
	</style>
</head>
<body class="js">

<!-- Preloader -->
<div class="preloader">
	<div class="preloader-inner">
		<div class="preloader-icon">
			<span></span><span></span>
		</div>
	</div>
</div>
<!-- End Preloader -->

<!-- Eshop Color Plate -->
<div class="color-plate ">
	<a class="color-plate-icon"><i class="ti-paint-bucket"></i></a>
	<h4>Eshop Colors</h4>
	<p>Here is some awesome color's available on Eshop Template.</p>
	<span class="color1"></span>
	<span class="color2"></span>
</div>
<!-- /End Color Plate -->

<!-- Header -->
<header class="header shop">
	<div class="topbar">
		<div class="container">
			<div class="row">
				<div class="col-lg-4 col-md-12 col-12">
					<div class="top-left">
						<ul class="list-main">
							<li><i class="ti-headphone-alt"></i> +060 (800) 801-582</li>
							<li><i class="ti-email"></i> support@shophub.com</li>
						</ul>
					</div>
				</div>
				<div class="col-lg-8 col-md-12 col-12">
					<div class="right-content">
						<ul class="list-main">
							<li><i class="ti-location-pin"></i> Store location</li>
							<li><i class="ti-alarm-clock"></i> <a href="#">Daily deal</a></li>
							<li><i class="ti-user"></i> <a href="#">My account</a></li>
							<li><i class="ti-power-off"></i><a href="login.html#">Login</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="middle-inner">
		<div class="container">
			<div class="row">
				<div class="col-lg-2 col-md-2 col-12">
					<div class="logo"><a href="index.html"><img src="/images/logo.png" alt="logo"></a></div>
					<div class="search-top">
						<div class="top-search"><a href="#0"><i class="ti-search"></i></a></div>
						<div class="search-top">
							<form class="search-form">
								<input type="text" placeholder="Search here..." name="search">
								<button value="search" type="submit"><i class="ti-search"></i></button>
							</form>
						</div>
					</div>
					<div class="mobile-nav"></div>
				</div>
				<div class="col-lg-8 col-md-7 col-12">
					<div class="search-bar-top">
						<div class="search-bar">
							<select>
								<option selected="selected">All Category</option>
								<option>watch</option>
								<option>mobile</option>
								<option>kid’s item</option>
							</select>
							<form>
								<input name="search" placeholder="Search Products Here....." type="search">
								<button class="btnn"><i class="ti-search"></i></button>
							</form>
						</div>
					</div>
				</div>
				<div class="col-lg-2 col-md-3 col-12">
					<div class="right-bar">
						<div class="sinlge-bar">
							<a href="#" class="single-icon"><i class="fa fa-heart-o" aria-hidden="true"></i></a>
						</div>
						<div class="sinlge-bar">
							<a href="#" class="single-icon"><i class="fa fa-user-circle-o" aria-hidden="true"></i></a>
						</div>
						<div class="sinlge-bar shopping">
							<a href="#" class="single-icon"><i class="ti-bag"></i> <span class="total-count">2</span></a>
							<div class="shopping-item">
								<div class="dropdown-cart-header">
									<span>2 Items</span><a href="#">View Cart</a>
								</div>
								<ul class="shopping-list">
									<li>
										<a href="#" class="remove"><i class="fa fa-remove"></i></a>
										<a class="cart-img" href="#"><img src="https://via.placeholder.com/70x70" alt="#"></a>
										<h4><a href="#">Woman Ring</a></h4>
										<p class="quantity">1x - <span class="amount">$99.00</span></p>
									</li>
									<li>
										<a href="#" class="remove"><i class="fa fa-remove"></i></a>
										<a class="cart-img" href="#"><img src="https://via.placeholder.com/70x70" alt="#"></a>
										<h4><a href="#">Woman Necklace</a></h4>
										<p class="quantity">1x - <span class="amount">$35.00</span></p>
									</li>
								</ul>
								<div class="bottom">
									<div class="total">
										<span>Total</span><span class="total-amount">$134.00</span>
									</div>
									<a href="checkout.html" class="btn animate">Checkout</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<div class="header-inner">
		<div class="container">
			<div class="cat-nav-head">
				<div class="row">
					<div class="col-12">
						<div class="menu-area">
							<nav class="navbar navbar-expand-lg">
								<div class="navbar-collapse">
									<div class="nav-inner">
										<ul class="nav main-menu menu navbar-nav">
											<li class="active"><a href="#">Home<i class="ti-angle-down"></i></a>
												<ul class="dropdown">
													<li><a href="index.html">Home Ecommerce V1</a></li>
													<li><a href="index2.html">Home Ecommerce V2</a></li>
													<li><a href="index3.html">Home Ecommerce V3</a></li>
													<li><a href="index4.html">Home Ecommerce V4</a></li>
												</ul>
											</li>
											<li><a href="#">Product</a></li>
											<li><a href="#">Service</a></li>
											<li><a href="#">Shop<i class="ti-angle-down"></i><span class="new">New</span></a>
												<ul class="dropdown">
													<li><a href="shop-grid.html">Shop Grid</a></li>
													<li><a href="shop-list.html">Shop List</a></li>
													<li><a href="shop-single.html">shop Single</a></li>
													<li><a href="cart.html">Cart</a></li>
													<li><a href="checkout.html">Checkout</a></li>
												</ul>
											</li>
											<li><a href="#">Pages<i class="ti-angle-down"></i></a>
												<ul class="dropdown">
													<li><a href="about-us.html">About Us</a></li>
													<li><a href="login.html">Login</a></li>
													<li><a href="register.html">Register</a></li>
													<li><a href="mail-success.html">Mail Success</a></li>
													<li><a href="404.html">404</a></li>
												</ul>
											</li>
											<li><a href="#">Blog<i class="ti-angle-down"></i></a>
												<ul class="dropdown">
													<li><a href="blog-grid.html">Blog Grid</a></li>
													<li><a href="blog-grid-sidebar.html">Blog Grid Sidebar</a></li>
													<li><a href="blog-single.html">Blog Single</a></li>
													<li><a href="blog-single-sidebar.html">Blog Single Sidebar</a></li>
												</ul>
											</li>
											<li><a href="contact.html">Contact Us</a></li>
										</ul>
									</div>
								</div>
							</nav>
							<!--/ End Main Menu -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</header>
<!--/ End Header -->

<div class="breadcrumbs">
	<div class="container">
		<div class="row">
			<div class="col-12">
				<div class="bread-inner">
					<ul class="bread-list">
						<li><a href="index1.html">Home<i class="ti-arrow-right"></i></a></li>
						<li class="active"><a href="blog-single.html">Shop Details</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<section class="shop single section">
	<div class="container">
		<div class="row">
			<div class="col-12">
				<div class="row">
					<div class="col-lg-6 col-12">
						<div class="product-gallery">
							<div class="flexslider-thumbnails">
								<ul class="slides">
									<li data-thumb="https://via.placeholder.com/570x520">
										<img src="https://via.placeholder.com/570x520" alt="#">
									</li>
									<li data-thumb="https://via.placeholder.com/570x520">
										<img src="https://via.placeholder.com/570x520" alt="#">
									</li>
									<li data-thumb="https://via.placeholder.com/570x520">
										<img src="https://via.placeholder.com/570x520" alt="#">
									</li>
									<li data-thumb="https://via.placeholder.com/570x520">
										<img src="https://via.placeholder.com/570x520" alt="#">
									</li>
								</ul>
							</div>
						</div>
					</div>
					<div class="col-lg-6 col-12">
						<div class="product-des">
							<div class="short">
								<h4>Nonstick Dishwasher PFOA</h4>
								<!-- 평균 평점 및 리뷰 수 표시 영역 -->
								<div id="avg-rating-container" style="margin-bottom:10px;"></div>
								<p class="price"><span class="discount">$70.00</span><s>$80.00</s></p>
								<p class="description">eget velit. Donec ac tempus ante...</p>
							</div>
							<div class="color">
								<h4>Available Options <span>Color</span></h4>
								<ul>
									<li><a href="#" class="one"><i class="ti-check"></i></a></li>
									<li><a href="#" class="two"><i class="ti-check"></i></a></li>
									<li><a href="#" class="three"><i class="ti-check"></i></a></li>
									<li><a href="#" class="four"><i class="ti-check"></i></a></li>
								</ul>
							</div>
							<div class="size">
								<h4>Size</h4>
								<ul>
									<li><a href="#" class="one">S</a></li>
									<li><a href="#" class="two">M</a></li>
									<li><a href="#" class="three">L</a></li>
									<li><a href="#" class="four">XL</a></li>
									<li><a href="#" class="four">XXL</a></li>
								</ul>
							</div>
							<div class="product-buy">
								<div class="quantity">
									<h6>Quantity :</h6>
									<div class="input-group">
										<div class="button minus">
											<button type="button" class="btn btn-primary btn-number" disabled="disabled" data-type="minus">
												<i class="ti-minus"></i>
											</button>
										</div>
										<input type="text" name="quant[1]" class="input-number" data-min="1" data-max="1000" value="1">
										<div class="button plus">
											<button type="button" class="btn btn-primary btn-number" data-type="plus">
												<i class="ti-plus"></i>
											</button>
										</div>
									</div>
								</div>
								<div class="add-to-cart">
									<a href="#" class="btn">Add to cart</a>
									<a href="#" class="btn min"><i class="ti-heart"></i></a>
									<a href="#" class="btn min"><i class="fa fa-compress"></i></a>
								</div>
								<p class="cat">Category :<a href="#">Clothing</a></p>
								<p class="availability">Availability : 180 Products In Stock</p>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-12">
						<div class="product-info">
							<div class="nav-main">
								<ul class="nav nav-tabs" id="myTab" role="tablist">
									<li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#description" role="tab">Description</a></li>
									<li class="nav-item"><a class="nav-link" data-toggle="tab" href="#reviews" role="tab">Reviews</a></li>
								</ul>
							</div>
							<div class="tab-content" id="myTabContent">
								<div class="tab-pane fade show active" id="description" role="tabpanel">
									<div class="tab-single">
										<div class="row">
											<div class="col-12">
												<div class="single-des">
													<p>simply dummy text of the printing ...</p>
												</div>
												<div class="single-des">
													<p>Suspendisse consequatur voluptates ...</p>
												</div>
												<div class="single-des">
													<h4>Product Features:</h4>
													<ul>
														<li>long established fact.</li>
														<li>has a more-or-less normal distribution.</li>
														<li>lmany variations of passages of.</li>
														<li>generators on the Interne.</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="tab-pane fade" id="reviews" role="tabpanel">
									<div class="tab-single">
										<div class="row">
											<div class="col-12">
												<div class="ratting-main" id="ratting-main"></div>
											</div>
										</div>
									</div>
								</div>
								<!--/ End Reviews Tab -->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</section>

<div class="product-area most-popular related-product section">
	<div class="container">
		<div class="row"><div class="col-12"><div class="section-title"><h2>Related Products</h2></div></div></div>
		<div class="row">
			<div class="col-12">
				<div class="owl-carousel popular-slider">
					<div class="single-product">
						<div class="product-img">
							<a href="product-details.html">
								<img class="default-img" src="https://via.placeholder.com/550x750" alt="#">
								<img class="hover-img" src="https://via.placeholder.com/550x750" alt="#">
								<span class="out-of-stock">Hot</span>
							</a>
							<div class="button-head">
								<div class="product-action">
									<a data-toggle="modal" data-target="#exampleModal" href="#"><i class=" ti-eye"></i><span>Quick Shop</span></a>
									<a href="#"><i class=" ti-heart "></i><span>Add to Wishlist</span></a>
									<a href="#"><i class="ti-bar-chart-alt"></i><span>Add to Compare</span></a>
								</div>
								<div class="product-action-2">
									<a href="#">Add to cart</a>
								</div>
							</div>
						</div>
						<div class="product-content">
							<h3><a href="product-details.html">Black Sunglass For Women</a></h3>
							<div class="product-price">
								<span class="old">$60.00</span>
								<span>$50.00</span>
							</div>
						</div>
					</div>
					<!-- ... 다른 상품들 ... -->
				</div>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document"><div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"><span class="ti-close" aria-hidden="true"></span></button>
		</div>
		<div class="modal-body">
			<div class="row no-gutters">
				<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
					<div class="product-gallery">
						<div class="quickview-slider-active">
							<div class="single-slider"><img src="https://via.placeholder.com/569x528" alt="#"></div>
							<div class="single-slider"><img src="https://via.placeholder.com/569x528" alt="#"></div>
							<div class="single-slider"><img src="https://via.placeholder.com/569x528" alt="#"></div>
							<div class="single-slider"><img src="https://via.placeholder.com/569x528" alt="#"></div>
						</div>
					</div>
				</div>
				<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
					<div class="quickview-content">
						<h2>Flared Shift Dress</h2>
						<div class="quickview-ratting-review">
							<div class="quickview-ratting-wrap">
								<div class="quickview-ratting">
									<i class="yellow fa fa-star"></i>
									<i class="yellow fa fa-star"></i>
									<i class="yellow fa fa-star"></i>
									<i class="yellow fa fa-star"></i>
									<i class="fa fa-star"></i>
								</div>
								<a href="#"> (1 customer review)</a>
							</div>
							<div class="quickview-stock"><span><i class="fa fa-check-circle-o"></i> in stock</span></div>
						</div>
						<h3>$29.00</h3>
						<div class="quickview-peragraph">
							<p>Lorem ipsum ...</p>
						</div>
						<div class="size">
							<div class="row">
								<div class="col-lg-6 col-12">
									<h5 class="title">Size</h5>
									<select>
										<option selected="selected">s</option>
										<option>m</option>
										<option>l</option>
										<option>xl</option>
									</select>
								</div>
								<div class="col-lg-6 col-12">
									<h5 class="title">Color</h5>
									<select>
										<option selected="selected">orange</option>
										<option>purple</option>
										<option>black</option>
										<option>pink</option>
									</select>
								</div>
							</div>
						</div>
						<div class="quantity">
							<div class="input-group">
								<div class="button minus">
									<button type="button" class="btn btn-primary btn-number" disabled="disabled" data-type="minus">
										<i class="ti-minus"></i>
									</button>
								</div>
								<input type="text" name="quant[1]" class="input-number" data-min="1" data-max="1000" value="1">
								<div class="button plus">
									<button type="button" class="btn btn-primary btn-number" data-type="plus">
										<i class="ti-plus"></i>
									</button>
								</div>
							</div>
						</div>
						<div class="add-to-cart">
							<a href="#" class="btn">Add to cart</a>
							<a href="#" class="btn min"><i class="ti-heart"></i></a>
							<a href="#" class="btn min"><i class="fa fa-compress"></i></a>
						</div>
						<div class="default-social">
							<h4 class="share-now">Share:</h4>
							<ul>
								<li><a class="facebook" href="#"><i class="fa fa-facebook"></i></a></li>
								<li><a class="twitter" href="#"><i class="fa fa-twitter"></i></a></li>
								<li><a class="youtube" href="#"><i class="fa fa-pinterest-p"></i></a></li>
								<li><a class="dribbble" href="#"><i class="fa fa-google-plus"></i></a></li>
							</ul>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div></div>
</div>

<!-- 주의사항:
   - 탭을 누르지 않아도 평균평점과 리뷰수는 항상 표시되게 수정함.
   - 별 표시 로직 수정: 항상 별은 5개 유지.
   - (리뷰수)를 클릭하면 리뷰 탭으로 이동하고 그쪽으로 스크롤 이동.
   - 페이지네이션, 더보기/접기 기능은 동일하게 동작.
   - 실제 서버연동이 아닌 로컬스토리지 기반 예제임.
-->

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery-migrate-3.0.0.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/colors.js"></script>
<script src="/js/slicknav.min.js"></script>
<script src="/js/owl-carousel.js"></script>
<script src="/js/magnific-popup.min.js"></script>
<script src="/js/facnybox.min.js"></script>
<script src="/js/waypoints.min.js"></script>
<script src="/js/finalcountdown.min.js"></script>
<script src="/js/nicesellect.js"></script>
<script src="/js/ytplayer.min.js"></script>
<script src="/js/flex-slider.js"></script>
<script src="/js/scrollup.js"></script>
<script src="/js/onepage-nav.min.js"></script>
<script src="/js/easing.js"></script>
<script src="/js/active.js"></script>
<script>
	let loggedInUserId = 'user1234'; // 로그인된 사용자
	const reviewsPerPage = 5;
	let currentPage = 1;
	const previewLength = 100;

	$(document).ready(function() {
		function displayAverageRatingAndCount(reviews) {
			let avgContainer = $('#avg-rating-container');
			avgContainer.empty();
			if(reviews.length === 0) {
				avgContainer.append('<div class="rating-main"><p>No reviews yet.</p></div>');
				return;
			}
			let sum = 0;
			reviews.forEach(r => sum += r.rating);
			let avg = sum / reviews.length;
			let reviewCount = reviews.length;

			// 별 표시 로직
			function getStarIcons(avgRating) {
				let fullStars = Math.floor(avgRating);
				let fraction = avgRating - fullStars;
				let stars = '';

				// Add full stars
				for(let i=0; i<fullStars; i++){
					stars += '<li><i class="fa fa-star"></i></li>';
				}

				// Check fraction
				if(fraction >= 0.75){
					// add one full star
					stars += '<li><i class="fa fa-star"></i></li>';
				} else if(fraction >= 0.25){
					// add half star
					stars += '<li><i class="fa fa-star-half-o"></i></li>';
				}

				// Count how many stars so far
				let totalStarCount = (stars.match(/fa-star/g) || []).length;
				let halfStarCount = stars.includes('fa-star-half-o') ? 1 : 0;
				totalStarCount = totalStarCount - halfStarCount; // full stars count
				let usedSlots = totalStarCount + halfStarCount;

				// Fill remaining with empty stars
				for(let i=usedSlots; i<5; i++){
					stars += '<li class="dark"><i class="fa fa-star-o"></i></li>';
				}

				return stars;
			}

			let starIcons = getStarIcons(avg);
			let avgDisplay = avg.toFixed(1);

			// 리뷰 수 클릭 -> 리뷰 탭 이동
			// data-target="#reviews" 가 있는 a를 클릭시 부트스트랩 탭 이동 가능
			let html = `
                <div class="rating-main">
                    <ul class="rating">
                        ${starIcons}
                    </ul>
                    <a href="#" class="total-review-link" style="cursor:pointer;">(${reviewCount} Review)</a>
                    <span style="margin-left:10px; font-size:14px; color:#333;">평균 평점: ${avgDisplay}</span>
                </div>
            `;
			avgContainer.append(html);
		}

		function loadReviews() {
			let reviews = JSON.parse(localStorage.getItem('reviews')) || [];
			let rattingMain = $('#ratting-main');
			rattingMain.empty();

			// 평균 평점 표시(항상)
			displayAverageRatingAndCount(reviews);

			if(reviews.length === 0){
				rattingMain.append('<p>작성된 리뷰가 없습니다.</p>');
				$('#pagination').remove();
				return;
			}

			let totalReviews = reviews.length;
			let totalPages = Math.ceil(totalReviews / reviewsPerPage);
			if(currentPage > totalPages) currentPage = totalPages;

			let startIndex = (currentPage - 1) * reviewsPerPage;
			let endIndex = startIndex + reviewsPerPage;
			let pageReviews = reviews.slice(startIndex, endIndex);

			pageReviews.forEach(function(review, index) {
				let starsHtml = '';
				for(let i = 1; i <= 5; i++) {
					starsHtml += (i <= review.rating) ? '<li><i class="fa fa-star"></i></li>' : '<li><i class="fa fa-star-o"></i></li>';
				}

				let imagesHtml = '';
				if(review.images && review.images.length > 0){
					imagesHtml += '<div class="image-preview">';
					review.images.forEach(function(imgSrc){
						imagesHtml += `<a href="${imgSrc}" target="_blank"><img src="${imgSrc}" alt="리뷰 이미지"></a>`;
					});
					imagesHtml += '</div>';
				}

				let timeText = '';
				if (review.updatedAt) {
					timeText = review.updatedAt + ' (수정됨)';
				} else {
					timeText = review.createdAt;
				}

				let fullMessage = review.message;
				let displayMessage = fullMessage;
				let toggleBtnHtml = '';
				if(fullMessage.length > previewLength) {
					displayMessage = fullMessage.substring(0, previewLength) + '...';
					toggleBtnHtml = `<button class="toggle-more-btn">더보기</button>`;
				}

				let editButton = '';
				if(review.user_id === loggedInUserId) {
					editButton = `<div><button class="edit-btn" data-index="${(startIndex + index)}">수정하기</button></div>`;
				}

				let singleRating = `
                    <div class="single-rating">
                        <div class="rating-des">
                            <h6>${review.user_id} <span style="font-size:12px; color:#999; margin-left:10px;">${timeText}</span></h6>
                            <div class="ratings"><ul class="rating">${starsHtml}</ul></div>
                            <p class="review-text" data-full="${encodeURIComponent(fullMessage)}">${displayMessage}</p>
                            ${toggleBtnHtml}
                            ${imagesHtml}
                            ${editButton}
                        </div>
                    </div>
                `;
				rattingMain.append(singleRating);
			});

			renderPagination(totalPages);
		}

		function renderPagination(totalPages) {
			$('#pagination').remove();
			if(totalPages <= 1) return;

			let paginationHtml = '<div id="pagination" style="text-align:center; margin-top:20px;">';
			for(let i=1; i<=totalPages; i++){
				if(i === currentPage){
					paginationHtml += `<span style="display:inline-block; padding:5px 10px; margin:0 5px; background:#333; color:#fff; border-radius:3px; cursor:pointer;">${i}</span>`;
				} else {
					paginationHtml += `<span class="page-btn" data-page="${i}" style="display:inline-block; padding:5px 10px; margin:0 5px; background:#eee; color:#333; border-radius:3px; cursor:pointer;">${i}</span>`;
				}
			}
			paginationHtml += '</div>';
			$('#ratting-main').after(paginationHtml);
		}

		$(document).on('click', '.page-btn', function(){
			currentPage = parseInt($(this).data('page'), 10);
			loadReviews();
		});

		$(document).on('click', '.toggle-more-btn', function(){
			let p = $(this).siblings('.review-text');
			let fullMessage = decodeURIComponent(p.data('full'));
			if($(this).text() === '더보기') {
				p.text(fullMessage);
				$(this).text('접기');
			} else {
				if(fullMessage.length > previewLength) {
					p.text(fullMessage.substring(0,previewLength) + '...');
					$(this).text('더보기');
				} else {
					p.text(fullMessage);
					$(this).hide();
				}
			}
		});

		$('#ratting-main').on('click', '.edit-btn', function() {
			let index = $(this).data('index');
			window.location.href = '/test/review?editIndex=' + index;
		});

		// 리뷰 탭 자동 진입
		// (리뷰수)를 클릭하면 리뷰 탭으로 이동하고 scroll
		$(document).on('click', '.total-review-link', function(e){
			e.preventDefault();
			// 탭 변경
			$('a[data-toggle="tab"][href="#reviews"]').tab('show');
			// 스크롤 이동
			$('html, body').animate({
				scrollTop: $("#reviews").offset().top
			}, 500);
		});

		// 페이지 로드 시 리뷰 로드(평균평점 항상 표시)
		// 그리고 탭을 열지 않아도 평균평점을 표시하기 위해 로드
		loadReviews();

		// 탭 전환시에도 loadReviews()는 필요하지만 이미 위에서 처리했으니
		// 리뷰 탭 클릭시 다시 한번 로드 (데이터 최신화 대비)
		$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
			var target = $(e.target).attr("href");
			if(target === '#reviews'){
				loadReviews();
			}
		});

		$(window).on('focus', function() {
			// 포커스 돌아왔을 때 리뷰탭 활성화 상태면 최신화
			if($('#reviews').hasClass('active')){
				loadReviews();
			}
		});
	});
</script>

</body>
</html>
